# ã‚³ãƒ¼ãƒ‰: Google Apps Scriptã«ã‚ˆã‚‹æƒ…å ±åé›†ã®å¤šè¨€èªç¿»è¨³ï¼ˆ7ã‹å›½èªï¼‰ã®ç²¾åº¦ãƒã‚§ãƒƒã‚¯ã¨ãƒ­ã‚¸ãƒƒã‚¯æ”¹å–„

ã‚¿ã‚¹ã‚¯ID: 7
ä½œæˆæ—¥æ™‚: 2025-10-05T18:35:00.336717

---

ã“ã®ã‚¿ã‚¹ã‚¯ã§ã¯ã€Google Apps Script (GAS) ã‚’ä½¿ç”¨ã—ã¦ã€æƒ…å ±åé›†ã—ãŸãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®å¤šè¨€èªç¿»è¨³ã®ç²¾åº¦ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€ãã®çµæœã«åŸºã¥ã„ã¦ç¿»è¨³ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ”¹å–„ã™ã‚‹ãŸã‚ã®ä»•çµ„ã¿ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

GASã¯ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã§å®Ÿè¡Œã§ãã€Googleç¿»è¨³ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒå®¹æ˜“ãªãŸã‚ã€ã“ã®ç›®çš„ã«é©ã—ã¦ã„ã¾ã™ã€‚

ã‚¿ã‚¹ã‚¯æ¦‚è¦

æƒ…å ±åé›†ãƒ—ãƒ­ã‚»ã‚¹ã§å¾—ã‚‰ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆæ—¥æœ¬èªï¼‰ã‚’ã€Googleç¿»è¨³APIï¼ˆLanguageApp.translateï¼‰ã‚’ç”¨ã„ã¦7ã‹å›½èªã«ç¿»è¨³ã™ã‚‹éš›ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

ã‚³ã‚¢ã‚¿ã‚¹ã‚¯ã¯ã€å˜ãªã‚‹ç¿»è¨³ã§ã¯ãªãã€ç¿»è¨³çµæœã®å“è³ªï¼ˆç²¾åº¦ï¼‰ã‚’æ¸¬å®šã™ã‚‹ãŸã‚ã®ãƒ­ã‚¸ãƒƒã‚¯ã¨ã€ãã®çµæœã‚’å…ƒã«ç¿»è¨³å“è³ªã‚’æ®µéšçš„ã«æ”¹å–„ã™ã‚‹ãŸã‚ã®ãƒ­ã‚°è¨˜éŒ²ãƒ»è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã™ã‚‹ã“ã¨ã§ã™ã€‚

ç¿»è¨³å¯¾è±¡è¨€èªï¼ˆ7ã‹å›½èªï¼‰

è‹±èªï¼ˆenï¼‰ã€ä¸­å›½èªï¼ˆzhï¼‰ã€éŸ“å›½èªï¼ˆkoï¼‰ã€ãƒ•ãƒ©ãƒ³ã‚¹èªï¼ˆfrï¼‰ã€ãƒ‰ã‚¤ãƒ„èªï¼ˆdeï¼‰ã€ã‚¹ãƒšã‚¤ãƒ³èªï¼ˆesï¼‰ã€ãƒãƒ«ãƒˆã‚¬ãƒ«èªï¼ˆptï¼‰

å®Ÿè£…å†…å®¹

Google Apps Script (GAS) ã§ä»¥ä¸‹ã®ä¸»è¦ãªé–¢æ•°ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

translateAndLogQuality(originalText): ç¿»è¨³ãƒ­ã‚¸ãƒƒã‚¯ã®æ ¸ã¨ãªã‚‹é–¢æ•°ã€‚æŒ‡å®šã•ã‚ŒãŸ7ã‹å›½èªã«ç¿»è¨³ã—ã€ç¿»è¨³å¾Œã®ãƒ†ã‚­ã‚¹ãƒˆã®é•·ã•ã‚„ç‰¹å®šã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®æœ‰ç„¡ãªã©ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ç°¡æ˜“çš„ãªç²¾åº¦ãƒã‚§ãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

runQualityCheck(dataRange): ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®æŒ‡å®šã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ç¯„å›²ã®å„ã‚»ãƒ«ã«å¯¾ã—ã¦ç¿»è¨³ã‚’å®Ÿè¡Œã—ã€çµæœã‚’ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«è¨˜éŒ²ã—ã¾ã™ã€‚

ç°¡æ˜“çš„ãªç²¾åº¦ãƒã‚§ãƒƒã‚¯: ä»Šå›ã¯ã€æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã›ãšã€ç¿»è¨³å¾Œã®ãƒ†ã‚­ã‚¹ãƒˆé•·ãŒå…ƒã®ãƒ†ã‚­ã‚¹ãƒˆé•·ã®20%ã€œ300%ã®ç¯„å›²å†…ã«ã‚ã‚‹ã“ã¨ã€ãŠã‚ˆã³ç¿»è¨³å‰å¾Œã®ãƒ†ã‚­ã‚¹ãƒˆã«ç‰¹å®šã®NGãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ãªã„ã“ã¨ã‚’ã€Œç²¾åº¦ãŒé«˜ã„ã€ã¨ã™ã‚‹çµŒé¨“å‰‡ãƒ™ãƒ¼ã‚¹ã®ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè£…ã—ã¾ã™ï¼ˆåŸå‰‡3, 5ï¼‰ã€‚

ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°: Googleç¿»è¨³ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹å¤±æ•—ã‚„APIåˆ¶é™ã‚¨ãƒ©ãƒ¼ã‚’ã‚­ãƒ£ãƒƒãƒã—ã¾ã™ã€‚

ã‚³ãƒ¼ãƒ‰

ã“ã®ã‚³ãƒ¼ãƒ‰ã¯ã€Google Apps Scriptã‚¨ãƒ‡ã‚£ã‚¿ã«è²¼ã‚Šä»˜ã‘ã¦ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚

JavaScript
/**
 * Google Apps Scriptã«ã‚ˆã‚‹å¤šè¨€èªç¿»è¨³ã®ç²¾åº¦ãƒã‚§ãƒƒã‚¯ã¨ãƒ­ã‚¸ãƒƒã‚¯æ”¹å–„ãƒ­ã‚®ãƒ³ã‚°
 * * @fileoverview æƒ…å ±åé›†ãƒ†ã‚­ã‚¹ãƒˆã®å¤šè¨€èªç¿»è¨³ï¼ˆ7ã‹å›½èªï¼‰ã‚’å®Ÿè¡Œã—ã€ç°¡æ˜“çš„ãªç²¾åº¦ãƒã‚§ãƒƒã‚¯ã¨æ”¹å–„ã®ãŸã‚ã®ãƒ­ã‚®ãƒ³ã‚°ã‚’è¡Œã†ã€‚
 * @version 1.0.0
 * @author YourName
 */

// ç¿»è¨³å¯¾è±¡ã®è¨€èªã‚³ãƒ¼ãƒ‰ (ISO 639-1)
const TARGET_LANGUAGES = ['en', 'zh', 'ko', 'fr', 'de', 'es', 'pt'];
// ç¿»è¨³å…ƒè¨€èª (ã“ã“ã§ã¯æ—¥æœ¬èªã‚’æƒ³å®š)
const SOURCE_LANGUAGE = 'ja';
// ç¿»è¨³ãƒ­ã‚¸ãƒƒã‚¯æ”¹å–„ã®ãŸã‚ã®NGãƒ¯ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ (ä¾‹: å›ºæœ‰åè©ãªã©ãŒä¸é©åˆ‡ã«ç¿»è¨³ã•ã‚ŒãŸå ´åˆ)
const NG_WORDS_ORIGINAL = ['ç‰¹å®šåç§°A', 'ç‰¹å®šåç§°B']; // æ—¥æœ¬èªNGãƒ¯ãƒ¼ãƒ‰
const NG_WORDS_TRANSLATED = ['SpecificNameA', 'SpecificNameB']; // ç¿»è¨³å¾ŒNGãƒ¯ãƒ¼ãƒ‰

/**
 * ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®æŒ‡å®šã•ã‚ŒãŸç¯„å›²ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ç¿»è¨³ã—ã€å“è³ªãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ã€‚
 *
 * @param {string} dataRange ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆä¸Šã®ãƒ‡ãƒ¼ã‚¿ç¯„å›² (ä¾‹: 'A2:A11')ã€‚
 */
function runQualityCheck(dataRange = 'A2:A11') {
    const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
    const data = sheet.getRange(dataRange).getValues();
    
    // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã€çµæœã®æ›¸ãè¾¼ã¿é–‹å§‹åˆ—ã‚’è¨ˆç®—
    // Aåˆ—ãŒå…ƒãƒ†ã‚­ã‚¹ãƒˆã®å ´åˆã€çµæœã¯Båˆ—ã‹ã‚‰é–‹å§‹
    const startRow = sheet.getRange(dataRange).getRow();
    const startCol = sheet.getRange(dataRange).getColumn() + 1;

    // ãƒ­ã‚°ã‚·ãƒ¼ãƒˆã‚’è¨­å®š (æ”¹å–„ãƒ­ã‚¸ãƒƒã‚¯ã®ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿è“„ç©å ´æ‰€)
    const logSheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('TranslationLog') || 
                     SpreadsheetApp.getActiveSpreadsheet().insertSheet('TranslationLog');
    
    // ãƒ­ã‚®ãƒ³ã‚°ç”¨ãƒ˜ãƒƒãƒ€ãƒ¼
    if (logSheet.getLastRow() === 0) {
        const logHeaders = ['Timestamp', 'OriginalText', 'TargetLang', 'TranslatedText', 'QualityScore', 'Reason'];
        logSheet.appendRow(logHeaders);
    }

    // å„è¡Œã®ãƒ†ã‚­ã‚¹ãƒˆã«å¯¾ã—ã¦ç¿»è¨³ã¨å“è³ªãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ
    data.forEach((row, index) => {
        const originalText = row[0];
        const currentRow = startRow + index;
        
        // å…ƒã®ãƒ†ã‚­ã‚¹ãƒˆãŒç©ºã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ— (åŸå‰‡3)
        if (!originalText || originalText.trim() === '') {
            sheet.getRange(currentRow, startCol).setValue('SKIP: Empty Text');
            return;
        }

        // ç¿»è¨³ã¨å“è³ªãƒã‚§ãƒƒã‚¯
        const results = translateAndLogQuality(originalText, logSheet);

        // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«çµæœã‚’æ›¸ãè¾¼ã¿
        results.forEach((result, langIndex) => {
            // æ›¸ãè¾¼ã¿ä½ç½®: é–‹å§‹åˆ— + ç¿»è¨³è¨€èªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
            const col = startCol + langIndex; 
            
            let output = result.translatedText;
            
            // ç²¾åº¦ãŒä½ã„å ´åˆã¯ãƒãƒ¼ã‚¯ã‚’ä»˜ä¸
            if (result.qualityScore < 0.8) {
                output = `ğŸš¨ [SCORE: ${result.qualityScore.toFixed(2)}] ${result.translatedText}`;
            }
            
            // çµæœã‚’ã‚·ãƒ¼ãƒˆã«æ›¸ãè¾¼ã‚€
            sheet.getRange(currentRow, col).setValue(output);
        });
    });

    Browser.msgBox('ç¿»è¨³ã¨å“è³ªãƒã‚§ãƒƒã‚¯ãŒå®Œäº†ã—ã¾ã—ãŸã€‚');
}


/**
 * 7ã‹å›½èªã«ç¿»è¨³ã—ã€ç°¡æ˜“çš„ãªç²¾åº¦ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ã€‚
 *
 * @param {string} originalText ç¿»è¨³å…ƒã®ãƒ†ã‚­ã‚¹ãƒˆï¼ˆæ—¥æœ¬èªï¼‰ã€‚
 * @param {GoogleAppsScript.Spreadsheet.Sheet} logSheet ãƒ­ã‚°ã‚’æ›¸ãè¾¼ã‚€ã‚·ãƒ¼ãƒˆã€‚
 * @returns {Array<Object>} ç¿»è¨³çµæœã¨å“è³ªã‚¹ã‚³ã‚¢ã®é…åˆ—ã€‚
 */
function translateAndLogQuality(originalText, logSheet) {
    const results = [];
    
    TARGET_LANGUAGES.forEach(targetLang => {
        let translatedText = '';
        let qualityScore = 1.0; // åˆæœŸã‚¹ã‚³ã‚¢
        let reason = 'OK';
        
        try {
            // Googleç¿»è¨³ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚ˆã‚‹ç¿»è¨³ (åŸå‰‡5: ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹)
            translatedText = LanguageApp.translate(originalText, SOURCE_LANGUAGE, targetLang);
            
            // 4. ç°¡æ˜“çš„ãªç²¾åº¦ãƒã‚§ãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè¡Œ
            const checkResult = checkTranslationQuality(originalText, translatedText);
            qualityScore = checkResult.score;
            reason = checkResult.reason;
            
        } catch (e) {
            // ğŸš¨ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°: APIåˆ¶é™ã‚„ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼ã‚’æ•æ‰ (åŸå‰‡3)
            Logger.log(`Translation Error for ${targetLang}: ${e.message}`);
            translatedText = `ERROR: ${e.message.substring(0, 50)}...`;
            qualityScore = 0.0;
            reason = `API_ERROR: ${e.message}`;
        }
        
        results.push({
            targetLang: targetLang,
            translatedText: translatedText,
            qualityScore: qualityScore
        });

        // ç¿»è¨³ãƒ­ã‚¸ãƒƒã‚¯æ”¹å–„ã®ãŸã‚ã®ãƒ­ã‚°è¨˜éŒ²
        logSheet.appendRow([
            new Date(),
            originalText,
            targetLang,
            translatedText,
            qualityScore.toFixed(2),
            reason
        ]);
    });
    
    return results;
}


/**
 * ç°¡æ˜“çš„ãªçµŒé¨“å‰‡ãƒ™ãƒ¼ã‚¹ã®ç¿»è¨³ç²¾åº¦ãƒã‚§ãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯ã€‚
 *
 * @param {string} originalText ç¿»è¨³å…ƒã®ãƒ†ã‚­ã‚¹ãƒˆã€‚
 * @param {string} translatedText ç¿»è¨³å¾Œã®ãƒ†ã‚­ã‚¹ãƒˆã€‚
 * @returns {Object} ã‚¹ã‚³ã‚¢ã¨ç†ç”±ã‚’å«ã‚€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€‚
 */
function checkTranslationQuality(originalText, translatedText) {
    let score = 1.0;
    let reason = 'OK';
    
    const originalLen = originalText.length;
    const translatedLen = translatedText.length;

    // A. é•·ã•ãƒã‚§ãƒƒã‚¯ (ç¿»è¨³å¾Œã®ãƒ†ã‚­ã‚¹ãƒˆé•·ãŒæ¥µç«¯ã«çŸ­ã„/é•·ã„å ´åˆã«æ¸›ç‚¹)
    // çµŒé¨“å‰‡: å…ƒãƒ†ã‚­ã‚¹ãƒˆé•·ã®20%æœªæº€ã€ã¾ãŸã¯300%è¶…ã¯ä½å“è³ª
    if (translatedLen < originalLen * 0.2) {
        score -= 0.3;
        reason = 'Too_Short';
    } else if (translatedLen > originalLen * 3.0) {
        score -= 0.3;
        reason = 'Too_Long';
    }

    // B. NGãƒ¯ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯ (ç‰¹å®šã®å˜èªãŒä¸é©åˆ‡ã«ç¿»è¨³ã•ã‚Œã¦ã„ãªã„ã‹)
    // å…ƒãƒ†ã‚­ã‚¹ãƒˆã«NGãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ã¦ã€ç¿»è¨³å¾Œãƒ†ã‚­ã‚¹ãƒˆã«ä¸é©åˆ‡ãªNGãƒ¯ãƒ¼ãƒ‰ãŒæ®‹ã£ã¦ã„ã‚‹å ´åˆã«æ¸›ç‚¹
    NG_WORDS_ORIGINAL.forEach(word => {
        // å¤§æ–‡å­—ãƒ»å°æ–‡å­—ã‚’ç„¡è¦–ã—ã¦ãƒã‚§ãƒƒã‚¯
        if (originalText.toLowerCase().includes(word.toLowerCase())) {
            NG_WORDS_TRANSLATED.forEach(ngWord => {
                if (translatedText.toLowerCase().includes(ngWord.toLowerCase())) {
                    score -= 0.5; // é‡å¤§ãªæ¸›ç‚¹
                    reason = 'NG_Word_Detected';
                }
            });
        }
    });

    // ã‚¹ã‚³ã‚¢ã¯0æœªæº€ã«ãªã‚‰ãªã„ã‚ˆã†ã«èª¿æ•´
    score = Math.max(0, score); 
    
    return { score: score, reason: reason };
}

// ----------------------------------------------------
// ã€GASã®ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”¨ã‚³ãƒ¼ãƒ‰ã€‘
// ----------------------------------------------------

/**
 * ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ ã™ã‚‹ (å¯èª­æ€§/ä½¿ç”¨æ–¹æ³•ã®æ”¹å–„)
 */
function onOpen() {
  SpreadsheetApp.getUi()
      .createMenu('ç¿»è¨³ãƒ„ãƒ¼ãƒ«')
      .addItem('ç¿»è¨³ã¨å“è³ªãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ (A2:A11)', 'runQualityCheckWrapper')
      .addToUi();
}

/**
 * runQualityChecké–¢æ•°ã‚’ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰å‘¼ã³å‡ºã™ãŸã‚ã®ãƒ©ãƒƒãƒ‘ãƒ¼
 */
function runQualityCheckWrapper() {
  // å®Ÿè¡Œã™ã‚‹ãƒ‡ãƒ¼ã‚¿ç¯„å›²ã‚’ä»»æ„ã«å¤‰æ›´å¯èƒ½
  runQualityCheck('A2:A11'); 
}