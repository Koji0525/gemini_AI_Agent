# ã‚³ãƒ¼ãƒ‰: ææºãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ç®¡ç†ç”¨CRMï¼ˆGoogle Sheetsãªã©ï¼‰ã®æ§‹ç¯‰ã¨åˆæœŸãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼æƒ…å ±ã®ç™»éŒ²

ã‚¿ã‚¹ã‚¯ID: 13
ä½œæˆæ—¥æ™‚: 2025-10-05T18:37:38.486718

---

å‰ã®ã‚¿ã‚¹ã‚¯ã§è¨­è¨ˆã—ãŸã€Œç¾åœ°ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼å€™è£œã€ã®ãƒªã‚¹ãƒˆç®¡ç†åŸºç›¤ã‚’ã€å…·ä½“çš„ãªGoogle Apps Script (GAS) ã‚’ç”¨ã„ã¦æ§‹ç¯‰ã—ã€åˆæœŸãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼æƒ…å ±ã‚’**ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆï¼ˆGoogle Sheetsï¼‰**ã¸ç™»éŒ²ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

ã“ã‚Œã¯ã€Google Sheetsã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã¨ã—ã¦ã€GASã‚’ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ­ã‚¸ãƒƒã‚¯ã¨ã—ã¦åˆ©ç”¨ã™ã‚‹ã€è¿…é€Ÿãªãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã«é©ã—ãŸãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã§ã™ã€‚

ã‚¿ã‚¹ã‚¯æ¦‚è¦

ææºãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼å€™è£œã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®ç°¡æ˜“CRMã‚’ã€Google Sheetsã¨Google Apps Script (GAS) ã‚’ç”¨ã„ã¦æ§‹ç¯‰ã—ã¾ã™ã€‚å…·ä½“çš„ã«ã¯ã€ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼æƒ…å ±ã®å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã®è¨­ç½®ï¼ˆGASã®UIï¼‰ã€ãƒ‡ãƒ¼ã‚¿ã®æ¤œè¨¼ã€ãŠã‚ˆã³ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¸ã®å®‰å…¨ãªç™»éŒ²ã‚’è¡Œã†ãŸã‚ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

ç›®çš„

ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼æƒ…å ±ã®ç™»éŒ²ãƒ»ç®¡ç†ã‚’æ§‹é€ åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿å½¢å¼ã§è¡Œã†ã€‚

ãƒ‡ãƒ¼ã‚¿ç™»éŒ²æ™‚ã«å…¥åŠ›æ¤œè¨¼ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’å®Ÿæ–½ã™ã‚‹ï¼ˆåŸå‰‡3ï¼‰ã€‚

GASã®ã‚«ã‚¹ã‚¿ãƒ UIã‚’åˆ©ç”¨ã—ã€ä½¿ã„ã‚„ã™ã„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æä¾›ã™ã‚‹ï¼ˆåŸå‰‡1ï¼‰ã€‚

å®Ÿè£…å†…å®¹

å®Ÿè£…ã¯ã€ä»¥ä¸‹ã®2ã¤ã®ä¸»è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§æ§‹æˆã•ã‚Œã¾ã™ã€‚

Google Apps Script (GAS):

onOpen(): ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’é–‹ã„ãŸã¨ãã«ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ ã—ã€å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‹ãæ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚

showPartnerForm(): ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼æƒ…å ±å…¥åŠ›ç”¨ã®HTMLã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼ˆãƒ•ã‚©ãƒ¼ãƒ ï¼‰ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

registerPartner(formData): ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚Šã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã£ãŸå¾Œã€ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ç™»éŒ²ã—ã¾ã™ã€‚

HTML/JavaScript:

å…¥åŠ›é …ç›®ï¼ˆæ°åã€ã‚«ãƒ†ã‚´ãƒªã€å„ªå…ˆåº¦ãªã©ï¼‰ã‚’æŒã¤ãƒ•ã‚©ãƒ¼ãƒ ã‚’å®šç¾©ã—ã¾ã™ã€‚

ãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡æ™‚ã«ãƒ‡ãƒ¼ã‚¿ã‚’GASã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é–¢æ•°ã«æ¸¡ã™JavaScriptãƒ­ã‚¸ãƒƒã‚¯ã‚’è¨˜è¿°ã—ã¾ã™ã€‚

ã‚³ãƒ¼ãƒ‰

1. Google Apps Script (GAS) ã‚³ãƒ¼ãƒ‰

ã“ã®ã‚³ãƒ¼ãƒ‰ã¯ã€Google Sheetsã®ã€Œæ‹¡å¼µæ©Ÿèƒ½ã€â†’ã€ŒApps Scriptã€ã‚¨ãƒ‡ã‚£ã‚¿ã«è²¼ã‚Šä»˜ã‘ã¾ã™ã€‚

JavaScript
/**
 * Partner Management CRM - Google Apps Script Backend
 * ææºãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼æƒ…å ±ã®ç™»éŒ²ã¨ç®¡ç†ã‚’è¡Œã†GASé–¢æ•°ç¾¤ã€‚
 *
 * @version 1.0
 * @author YourName
 */

// å®šæ•°å®šç¾©
const SHEET_NAME = 'PartnerList';
const HEADERS = [
    'Partner ID', 'Full Name (Local)', 'Full Name (Romaji)', 'Role Category', 
    'Organization', 'Contact Source', 'Initial Priority', 'Key Expertise', 
    'Risk Flag', 'Data Collector', 'Created At'
];

/**
 * 1. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’é–‹ã„ãŸã¨ãã«ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ä½œæˆ (åŸå‰‡1)
 */
function onOpen() {
    SpreadsheetApp.getUi()
        .createMenu('ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ç®¡ç†CRM')
        .addItem('æ–°è¦ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ç™»éŒ²', 'showPartnerForm')
        .addToUi();
}

/**
 * 2. ã‚µã‚¤ãƒ‰ãƒãƒ¼ã«ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤º
 */
function showPartnerForm() {
    // ãƒ•ã‚©ãƒ¼ãƒ ã®HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ­ãƒ¼ãƒ‰
    const html = HtmlService.createHtmlOutputFromFile('PartnerForm')
        .setWidth(300)
        .setTitle('æ–°è¦ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼æƒ…å ±ç™»éŒ²');
    SpreadsheetApp.getUi().showSidebar(html);
}

/**
 * 3. ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼æƒ…å ±ç™»éŒ²ãƒ­ã‚¸ãƒƒã‚¯ (ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹)
 *
 * @param {Object} formData ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰é€ä¿¡ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿
 * @returns {Object} ç™»éŒ²çµæœ (æˆåŠŸ/å¤±æ•—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸)
 */
function registerPartner(formData) {
    const ss = SpreadsheetApp.getActiveSpreadsheet();
    let sheet = ss.getSheetByName(SHEET_NAME);

    // ã‚·ãƒ¼ãƒˆãŒå­˜åœ¨ã—ãªã„å ´åˆã¯æ–°è¦ä½œæˆã—ã€ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¨­å®š
    if (!sheet) {
        sheet = ss.insertSheet(SHEET_NAME);
        sheet.appendRow(HEADERS);
    }
    
    // ğŸš¨ ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° (åŸå‰‡3, 1)
    if (!formData.fullNameLocal || !formData.roleCategory || !formData.contactSource || !formData.initialPriority) {
        return { success: false, message: 'ã‚¨ãƒ©ãƒ¼: å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒç©ºã§ã™ (æ°å, ã‚«ãƒ†ã‚´ãƒª, æƒ…å ±æº, å„ªå…ˆåº¦)ã€‚' };
    }

    // ãƒ‡ãƒ¼ã‚¿ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã¨å‹å¤‰æ›
    const initialPriority = parseInt(formData.initialPriority);
    const riskFlag = formData.riskFlag === 'true'; // æ–‡å­—åˆ—ã‚’ãƒ–ãƒ¼ãƒ«å€¤ã«å¤‰æ›
    
    // å„ªå…ˆåº¦ãŒæœ‰åŠ¹ãªç¯„å›²å†…ã‹ãƒã‚§ãƒƒã‚¯ (1-5)
    if (isNaN(initialPriority) || initialPriority < 1 || initialPriority > 5) {
        return { success: false, message: 'ã‚¨ãƒ©ãƒ¼: åˆæœŸå„ªå…ˆåº¦ã¯1ã‹ã‚‰5ã®æ•°å€¤ã§æŒ‡å®šã—ã¦ãã ã•ã„ã€‚' };
    }
    
    try {
        // IDã®ç”Ÿæˆ: æœ€å¾Œã®è¡Œã®ID + 1ã¨ã™ã‚‹ (ç°¡æ˜“çš„ãªã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£å¯¾ç­–)
        const lastRow = sheet.getLastRow();
        const partnerId = lastRow === 0 ? 1 : (sheet.getRange(lastRow, 1).getValue() || 0) + 1;
        
        // ãƒ‡ãƒ¼ã‚¿ã®æ§‹ç¯‰
        const rowData = [
            partnerId,
            formData.fullNameLocal,
            formData.fullNameRomaji || '',
            formData.roleCategory,
            formData.organization || '',
            formData.contactSource,
            initialPriority,
            formData.keyExpertise || '',
            riskFlag ? 'TRUE' : 'FALSE',
            Session.getActiveUser().getEmail() || 'System', // ğŸš¨ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¨˜éŒ²
            new Date()
        ];
        
        // ãƒ‡ãƒ¼ã‚¿ã‚’ã‚·ãƒ¼ãƒˆã«è¿½è¨˜
        sheet.appendRow(rowData);
        
        // ã‚·ãƒ¼ãƒˆã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆèª¿æ•´ (å¯èª­æ€§å‘ä¸Š)
        if (sheet.getLastRow() === 2) { // åˆå›ãƒ‡ãƒ¼ã‚¿ç™»éŒ²æ™‚ã®ã¿
            sheet.setColumnWidth(2, 180);
            sheet.setColumnWidth(6, 250);
            sheet.setFrozenRows(1);
        }

        return { success: true, message: `ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ID ${partnerId} ã®ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸã€‚` };

    } catch (e) {
        // ğŸš¨ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ›¸ãè¾¼ã¿æ™‚ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        Logger.log('Database Write Error: ' + e.toString());
        return { success: false, message: 'è‡´å‘½çš„ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + e.toString() };
    }
}


2. HTML/JavaScript ã‚³ãƒ¼ãƒ‰ (PartnerForm.html)

GASã‚¨ãƒ‡ã‚£ã‚¿ã§ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã€â†’ã€Œæ–°è¦ä½œæˆã€â†’ã€ŒHTMLã€ã‚’é¸æŠã—ã€ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ PartnerForm ã¨ã—ã¦ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ã¾ã™ã€‚

HTML
<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <style>
        body { font-family: sans-serif; margin: 10px; }
        .form-group { margin-bottom: 10px; }
        label { display: block; font-weight: bold; margin-bottom: 3px; }
        input[type="text"], input[type="number"], select {
            width: 95%; padding: 5px; border: 1px solid #ccc; border-radius: 4px;
        }
        button { padding: 8px 15px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background-color: #45a049; }
        .required::after { content: " *"; color: red; }
        #message { margin-top: 10px; padding: 10px; border-radius: 4px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <form id="partnerForm">
        <div class="form-group">
            <label for="fullNameLocal" class="required">æ°å (ç¾åœ°èª):</label>
            <input type="text" id="fullNameLocal" name="fullNameLocal" required>
        </div>
        <div class="form-group">
            <label for="fullNameRomaji">æ°å (ãƒ­ãƒ¼ãƒå­—):</label>
            <input type="text" id="fullNameRomaji" name="fullNameRomaji">
        </div>
        <div class="form-group">
            <label for="roleCategory" class="required">å½¹å‰²ã‚«ãƒ†ã‚´ãƒª:</label>
            <select id="roleCategory" name="roleCategory" required>
                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                <option value="å¼è­·å£«">å¼è­·å£«</option>
                <option value="æ”¿æ²»å®¶">æ”¿æ²»å®¶</option>
                <option value="ITãƒ‘ãƒ¼ã‚¯ä¸»è¦äººç‰©">ITãƒ‘ãƒ¼ã‚¯ä¸»è¦äººç‰©</option>
                <option value="è²¡ç•Œäºº">è²¡ç•Œäºº</option>
                <option value="ãã®ä»–">ãã®ä»–</option>
            </select>
        </div>
        <div class="form-group">
            <label for="organization">æ‰€å±çµ„ç¹”:</label>
            <input type="text" id="organization" name="organization">
        </div>
        <div class="form-group">
            <label for="contactSource" class="required">æƒ…å ±æº:</label>
            <input type="text" id="contactSource" name="contactSource" required placeholder="ä¾‹: Aæ°ç´¹ä»‹, LinkedIn, ã€‡ã€‡ãƒ‹ãƒ¥ãƒ¼ã‚¹">
        </div>
        <div class="form-group">
            <label for="initialPriority" class="required">åˆæœŸå„ªå…ˆåº¦ (1-5):</label>
            <input type="number" id="initialPriority" name="initialPriority" min="1" max="5" required>
        </div>
        <div class="form-group">
            <label for="keyExpertise">ä¸»ãªå°‚é–€åˆ†é‡:</label>
            <input type="text" id="keyExpertise" name="keyExpertise">
        </div>
        <div class="form-group">
            <input type="checkbox" id="riskFlag" name="riskFlag" value="true">
            <label for="riskFlag" style="display: inline;">ãƒªã‚¹ã‚¯æ‡¸å¿µã‚ã‚Š</label>
        </div>
        
        <button type="submit" id="submitButton">ç™»éŒ²</button>
    </form>
    <div id="message"></div>

    <script>
        document.getElementById('partnerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const form = e