# 設計書: 企業情報表示項目（CPT/CF）の詳細定義書作成。全項目についてデータ型、必須/任意、暗号化要否を確定させる。

タスクID: 32
作成日時: 2025-10-05T21:43:48.834034

---

はい、経験豊富なシステム設計者として、M&Aポータルサイトのコアとなる企業情報表示項目の詳細定義書を作成します。この定義は、今後のUI/UX設計、データベースの整合性、およびセキュリティ実装の基盤となります。

タスク概要

目的

M&A案件データ（ma_case CPT）に紐づく企業情報に関するカスタムフィールド（CF）について、各項目の**メタキー名、データ型、入力要件、および機密性（暗号化の要否）**を具体的に定義します。

スコープ

案件の基本情報、財務情報、および取引条件に関するカスタムフィールドの定義。

データの入力および表示に必要なデータ型（DB/PHP）の確定。

要件に基づき、必須項目（REQUIRED）と暗号化対象項目（ENCRYPT）を明確に区分。

設計内容

企業情報カスタムフィールド（CF）詳細定義

以下のカスタムフィールドは、すべてwp_postmetaテーブルに格納され、キー（メタキー名）は一意です。暗号化要否は、機密情報（価格、詳細財務）の保護を前提としています。

No.	表示項目名	メタキー名	データ型 (PHP/DB)	入力要件	暗号化要否	備考
基本情報						
1	企業名	company_name	string (VARCHAR)	REQUIRED	NO	一般公開時の匿名化に利用する。
2	所在地（詳細）	detail_location	string (VARCHAR)	REQUIRED	NO	タクソノミー（location）とは別に、詳細を格納。
3	設立年月日	establishment_date	string (YYYY-MM-DD)	OPTIONAL	NO	
4	従業員数	employees_count	int (BIGINT)	REQUIRED	NO	案件検索のソート/フィルタに使用。
5	事業概要（公開用）	business_summary	string (TEXT)	REQUIRED	NO	
財務・収益情報						
6	直近年間売上	latest_revenue	float/int	REQUIRED	ENCRYPT	機密情報。数値としてDBに暗号化格納。
7	直近年間利益(EBITDA)	latest_ebitda	float/int	REQUIRED	ENCRYPT	機密情報。数値としてDBに暗号化格納。
8	財務詳細データ	financial_data	array/JSON string	OPTIONAL	ENCRYPT	複数年度のPL/BS詳細をJSON形式で格納。
取引条件						
9	希望譲渡価格	price_amount	float/int	REQUIRED	ENCRYPT	最重要機密情報。数値としてDBに暗号化格納。
10	譲渡理由	transfer_reason	string (TEXT)	REQUIRED	NO	
11	譲渡スキームの意向	scheme_preference	string (VARCHAR)	REQUIRED	NO	タクソノミー（ma_scheme）とは別に、詳細意向を格納。
12	掲載期間終了日	end_date	string (YYYY-MM-DD)	REQUIRED	NO	案件公開のライフサイクル管理用。
Google スプレッドシートにエクスポート

技術選定

分野	技術	選定理由
カスタムフィールド管理	Advanced Custom Fields (ACF) Pro または Custom Post Type UI (CPT UI)	開発効率の最大化。特にfinancial_dataのようなリピーターフィールドやグループフィールドの管理、フォーム作成を容易にする。
データ型	PHPのstring/int/float	WordPressのwp_postmetaは値（meta_value）をLONGTEXTとして格納するため、PHP側で型変換（キャスト）を行う実装を前提とする。数値データはmeta_value_numによる検索/ソートを考慮。
暗号化	AES-256-GCM (PHP OpenSSL)	必須項目（latest_revenue, price_amountなど）の機密性と完全性を保証するため、設計済みモジュールを使用する。
検索/ソート	MySQL meta_value_num / 外部検索エンジン	employees_countのような非暗号化の数値はmeta_value_numインデックスを利用。暗号化された数値はDB検索ができないため、**外部検索エンジン（Elasticsearchなど）**を必須とする。
Google スプレッドシートにエクスポート

実装における注意点

データ型キャスト: latest_revenueやprice_amountはPHPではfloatまたはintとして扱われるが、DBには暗号化後のstringまたは複合化後の数値として保存/取得されます。特に暗号化/複合化モジュールでは、データの整合性を保つための厳密な型変換（例: (float)$decrypted_value）を実装すること。

ACF連携: ACFを使用する場合、暗号化/複合化フック（get_post_metadata/update_post_metadata）がACFの処理と正しく連携するように、フックの優先度やACF独自のフック（acf/load_value, acf/update_value）の利用を検討すること。

暗号化と検索の分離: 暗号化されたフィールドは、WordPressの標準機能（meta_query）では検索・ソートが不可能です。これを実現するためには、外部検索エンジンへのデータ同期と、検索時のカスタムクエリロジックの実装が必須となります。

匿名化: 案件公開時、company_nameなどの情報は、プライバシー保護のためにランダムな文字列（例: 「A社」）に置き換える匿名化ロジックを、フロントエンド表示用フックで実装すること。

次のステップ

UI/UX画面設計 (required_role: ui): 上記のカスタムフィールド定義に基づき、提携パートナーが案件を登録/編集するための入力フォームと、管理者/パートナー向けの一覧/詳細画面のワイヤーフレームを作成する。

API仕様の定義（REST API） (required_role: design): 外部連携を可能にするため、RBACと暗号化ロジックを考慮に入れた案件情報取得用REST APIのエンドポイントと認証要件を定義する。

コアモジュールの実装 (required_role: dev): 定義済みのCPT、カスタムロール、RBAC、および暗号化/複合化ロジックの統合開発を完了させ、テスト可能な状態にする。