# 設計書: 定義した全要件（CPT/CF、検索、パートナー機能、セキュリティ）の統合要件定義書最終版作成

タスクID: 8
作成日時: 2025-10-05T21:06:40.844926

---

はい、経験豊富なシステム設計者として、これまで定義した全ての要件と仕様を統合し、M&Aポータルサイト構築のための統合要件定義書最終版の作成タスクを実行します。これは、以降の開発フェーズにおける唯一の公式文書となります。

タスク概要

目的

これまで個別に設計・定義してきた以下の主要機能仕様を統合・整理し、矛盾や漏れがないかを確認した上で、開発チームが参照すべき最終的な統合要件定義書として文書化します。

スコープ

**企業情報表示項目とデータ構造（CPT/CF）**の最終定義。

検索機能の具体的な仕様（クエリ、レンジ検索、ソート）。

提携パートナー管理機能の仕様（RBAC、ワークフロー、アクセス制御）。

セキュリティ/アクセス制御の仕様（機密情報表示、暗号化、認証）。

技術選定と環境構築の前提条件。

設計内容

統合要件定義書は、以下の構成で最終化し、各章が前タスクで定義された内容を完全に継承・統合していることを保証します。

1. サイトの概要と目標

プロジェクトの目的、スコープ（M&Aポータルサイトの要件定義）、および成功基準を記載。

【超重要】 WordPress上で企業情報登録と絞り込み検索を実現するという前提を明記。

2. 機能要件の詳細定義

2.1. 企業情報表示項目とデータ構造

カスタム投稿タイプ: ma_caseを案件情報として確定。

カスタムタクソノミー: ma_scheme, industry, location, statusを確定し、その利用目的（検索フィルタ、表示）を明記。

カスタムフィールド: 全項目（price_amount, revenue_historyなど）のキー名、データ型、必須/任意、暗号化要否を一覧表で確定。

統合確認: 価格 (price_amount) は検索とセキュリティの両面から、数値型での格納と暗号化の対象であることを明記。

2.2. 検索機能の最終仕様

検索対象: 案件名、業種、所在地、価格帯、M&Aスキームの5項目を確定。

レンジ検索ロジック: meta_queryによるprice_amountのNUMERIC BETWEEN検索を確定。

結果表示: 1ページ20件、ページネーション、ソート機能（新着/更新日/価格順）を確定。

2.3. 提携パートナー管理機能の最終仕様

ユーザーロール: Partnerロールを確定。

アクセス制御（RBAC）: **pre_get_posts**フックによる「自身が登録した案件のみ」の閲覧・編集制御を最重要要件として明記。

案件ワークフロー: パートナー登録→pending（承認待ち）→管理者承認→publish（公開中）の遷移を確定。成約済みのprivateまたはカスタムステータスへの自動非表示ロジックを確定。

案件閲覧履歴: (前タスクで不足したため、別途定義されたデータ構造とトラッキングロジックをここに組み込む)。

3. 非機能要件（セキュリティとパフォーマンス）

3.1. セキュリティ（最優先事項）

アクセスレベル: 機密情報（価格など）は、特定権限ユーザーのみが具体的な値にアクセス可能とし、それ以外はレンジまたは非公開表示とすることを確定。

データ保護: 機密データのデータベース暗号化（AES-256など）を必須とし、暗号鍵はDB外で厳重に管理することを明記。

認証・認可: パートナーアカウントのMFA導入推奨と、全通信の**TLS/SSL (HTTPS)**必須を確定。

3.2. パフォーマンスとスケーラビリティ

検索パフォーマンス: wp_postmetaテーブルのインデックス最適化を必須とする。

キャッシュ: ログインユーザー（特に機密情報表示権限を持つユーザー）のキャッシュは分離または無効化することを確定。

技術選定

分野	技術	最終決定理由
ベースCMS	WordPress	プロジェクトの最重要前提。迅速なプロトタイプ開発とUI/UX構築を可能にする。
データ構造	ACF Pro (Advanced Custom Fields Pro)	複雑なカスタムフィールド、特に繰り返しフィールドや入力バリデーションを効率的に実装するため。
検索機能	WP_Query + Search & Filter Pro/FacetWP	meta_queryとtax_queryをGUIで拡張し、価格レンジ検索や多軸フィルタリングを迅速に実現するため。
ユーザー管理	User Role Editor + Custom Hooks	Partnerカスタムロール定義と、pre_get_postsを用いた厳格なRBACロジック実装のため。
暗号化	PHP OpenSSL拡張	機密データをデータベースに格納する際の堅牢な対称鍵暗号化ロジックを実装するため。
Google スプレッドシートにエクスポート

実装における注意点

セキュリティレイヤーの徹底: 機密情報の表示制御は、テーマテンプレートでのフロントエンド制御だけでなく、必ずデータ取得前の**バックエンド（フック）**で二重にチェック・マスキングを行うこと。

パフォーマンスベンチマーク: 検索機能は初期実装後、大量データ投入によるクエリ応答速度のベンチマークテストを必須とする。性能が出ない場合は、Elasticsearchへの移行計画をすぐに開始できるよう準備すること。

鍵管理と復号化: 暗号化ロジック開発者は、暗号鍵が本番環境でどのように安全に注入・管理されるか、復号化処理が正しく行われるかを、開発前にシステム管理者と確認すること。

データ整合性: 案件ステータス変更時（例：公開中→成約済）は、関連する全ての表示（検索結果、詳細ページ）が即座に正しく更新されることを保証するテストケースを作成すること。

次のステップ

開発環境構築タスク: 定義された技術スタック（WordPress、ACF、選定プラグイン、サーバー環境）に基づき、開発環境と本番デプロイパイプラインの構築を開始する。

UI/UX画面設計（全画面）: 案件一覧、詳細、検索、提携パートナー管理画面など、全ての画面の最終ワイヤーフレームとデザイン要素を確定させる。

テスト計画書作成: 定義された要件（特に検索精度とアクセス制御）に基づき、網羅的な受け入れテスト項目とセキュリティテストの計画書を作成する。