# 設計書: 企業情報表示項目の定義に基づき、WordPressにおけるカスタム投稿タイプ（案件）とカスタムフィールド（ACF、Custom Post Type UI等のプラグイン利用想定）の具体的なデータ構造設計を定義する。

タスクID: 12
作成日時: 2025-10-05T21:13:15.880232

---

はい、経験豊富なシステム設計者として、定義された企業情報表示項目に基づき、WordPressにおけるカスタム投稿タイプ（CPT）とカスタムフィールド（CF）の具体的なデータ構造設計を定義します。

タスク概要

目的

M&A案件の要件定義で確定した全表示項目について、WordPressのカスタム投稿タイプ（CPT）とカスタムフィールド（CF）、およびカスタムタクソノミー（CT）を用いて、データベースに格納するための具体的な構造設計を定義します。これにより、案件データ管理の基礎を確立し、開発フェーズで利用する技術（ACFなど）の設定に直接利用できるドキュメントを作成します。

スコープ

CPTの名称と基本設定の定義。

全カスタムフィールドのキー名、データ型、格納グループの定義。

全カスタムタクソノミーの名称と階層構造の定義。

セキュリティ要件（暗号化）の対象となるフィールドの明記。

設計内容

1. カスタム投稿タイプ (CPT) の定義

項目	設定値	備考
名称 (スラッグ)	ma_case	M&A案件を格納する唯一の投稿タイプ。
公開設定	publicly_queryable: true, show_ui: true	フロントエンドでの表示、管理画面での操作を許可。
サポート機能	title, editor (キーワード/譲渡理由用), thumbnail	案件名、譲渡理由のフリーテキスト入力、案件画像（企業ロゴなど）をサポート。
パーマリンク	/case/%ma_case%/	案件IDなどを含む構造を想定。
投稿者機能	author を有効化	提携パートナー（投稿者）によるアクセス制御（RBAC）の基盤とする。
Google スプレッドシートにエクスポート

2. カスタムタクソノミー (CT) の定義

検索機能および分類に利用するため、以下のカスタムタクソノミーを定義し、CPT ma_case に関連付けます。

名称 (スラッグ)	表示名	階層構造	複数選択	備考
ma_scheme	M&Aスキーム	なし	許可	株式譲渡、事業譲渡など。
industry	業種カテゴリ	なし	許可	標準化された分類。検索フィルタ対象。
location	所在地	あり	許可	都道府県/市区町村など。階層構造を利用。
status	進捗ステータス	なし	不許可	公開中、商談中、成約済など。案件ワークフロー制御に使用。
Google スプレッドシートにエクスポート

3. カスタムフィールド (CF) の定義（ACF利用を想定）

カスタムフィールドは、案件の属性情報や機密情報を格納します。ACFのフィールドグループを「基本情報」「財務情報」「買い手ニーズ」に分割して管理します。

A. フィールドグループ：案件基本情報 (必須/共通)

キー名	ACFフィールドタイプ	必須	暗号化	備考
price_amount	Number (数値)	必須	対象	希望売却/買収価格（万円単位）。検索・ソート用。
price_range_text	Text (文字列)	必須	なし	一般公開用テキスト（例: 「非公開」）。
start_date	Date Picker (日付)	必須	なし	掲載開始日。
end_date	Date Picker (日付)	必須	なし	掲載終了日。
Google スプレッドシートにエクスポート

B. フィールドグループ：売り手企業詳細情報 (機密情報含む)

キー名	ACFフィールドタイプ	必須	暗号化	備考
establishment_year	Number (数値)	必須	なし	設立年 (YYYY)。
employees_count	Number (数値)	必須	なし	従業員数。
financial_data	Repeater (繰り返し)	必須	対象	直近3期の売上/利益をJSON構造で格納。内部のサブフィールドも暗号化。
acquisition_purpose	Textarea (複数行)	必須	なし	買収目的（買い手ニーズ登録時）。
Google スプレッドシートにエクスポート

C. フィールドグループ：買い手企業ニーズ情報

キー名	ACFフィールドタイプ	必須	暗号化	備考
target_industries	Taxonomy (タクソノミー)	必須	なし	target_industryタクソノミーを選択。
target_locations	Taxonomy (タクソノミー)	必須	なし	target_locationタクソノミーを選択。
notes	Textarea (複数行)	任意	なし	その他メモ。
Google スプレッドシートにエクスポート

技術選定

分野	技術	選定理由
CPT/CT 定義	Custom Post Type UI (CPT UI)	コードを書かずにカスタム投稿タイプとタクソノミーを容易に定義・管理できるため。
CF 管理	ACF Pro (Advanced Custom Fields Pro)	数値型、繰り返しフィールド（Repeater for financial_data）など、複雑なデータ構造を直感的に実装・管理でき、開発効率が高いため。
データ型	数値型 (Number)	price_amountを数値型で格納することで、MySQLのmeta_value_numインデックスを利用した正確なレンジ検索とソートを可能にするため。
Google スプレッドシートにエクスポート

実装における注意点

暗号化ロジックの実装: price_amountとfinancial_dataについては、ACFのフィールド設定とは別に、WordPressのフック（acf/save_postやupdate_post_meta）を利用して、データベースへの保存直前にPHP OpenSSL拡張などで暗号化するカスタムロジックを必ず実装すること。

投稿者の設定: CPT ma_case の登録時、post_authorに提携パートナーのユーザーIDが正しく設定されるよう、フォームからのデータ処理を設計すること。これはRBACの根幹となる。

データ型の強制: ACFの設定において、price_amountなどの数値型フィールドは、入力時に数値以外が入力されないようバリデーションを厳しく設定すること。

次のステップ

検索機能の実装仕様設計: 定義されたCF/CT（price_amount, industryなど）をキーとした絞り込み検索機能の具体的なクエリロジックとUI振る舞いを設計する。

提携パートナー管理機能の設計: CPT ma_caseとpost_authorの関連性に基づき、自身が登録した案件のみを閲覧・編集できるアクセス制御（RBAC）の具体的なロジックを設計する。