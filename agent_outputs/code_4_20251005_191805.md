# コード: WordPressにカスタム投稿タイプとカスタムフィールドを定義し、テスト企業データ（5件程度）を入力

タスクID: 4
作成日時: 2025-10-05T19:18:05.513149

---

経験豊富なソフトウェアエンジニアとして、WordPressのM&Aポータルサイト構築における初期データ構造定義とテストデータ投入を行います。このタスクは主にWordPressの関数（PHP）と管理画面操作に依存しますが、コードとして定義すべきはカスタム投稿タイプ (CPT) とカスタムフィールド (ACF) の登録処理です。

ここでは、テーマのfunctions.phpまたは専用プラグインで定義するためのPHPコードと、ACFの設定をエクスポートしたJSON、そしてテストデータの入力手順を示します。

タスク概要

カスタム投稿タイプ (ma_deal) とカスタムタクソノミー (industry, location) を定義するPHPコードを実装します。また、先行タスクで設計されたカスタムフィールドをAdvanced Custom Fields (ACF) プラグインを用いて定義し、テスト用のM&A案件データ5件を管理画面から手動で入力し、データ構造の動作検証とポータル機能開発の土台を準備します。

実装内容

カスタム投稿タイプとタクソノミーの登録 (PHP): WordPressのregister_post_typeとregister_taxonomy関数を使用して定義します。これはテーマのfunctions.phpまたは機能プラグインに配置します。

カスタムフィールドの定義 (ACF JSON): ACFプラグインで設計されたフィールドグループを定義し、その設定をJSON形式でエクスポートします。これにより、環境間の移動やバージョン管理が容易になります。

テストデータ入力: 定義されたCPTとカスタムフィールドを使用して、実際に5件のダミー案件データを管理画面から手動で入力します。

コード

ここでは、カスタム投稿タイプとカスタムタクソノミーを定義するPHPコードを示します。ACFの設定はJSONとして扱います。

1. PHP: CPTとカスタムタクソノミーの定義（functions.php or 独自プラグイン）

PHP
<?php
/**
 * M&Aポータルサイト CPT/タクソノミー定義
 *
 * @package MA_Portal
 * @since 1.0.0
 */

// CPTとカスタムタクソノミーを登録するアクションフック
add_action('init', 'register_ma_deal_components');

/**
 * M&A案件のカスタム投稿タイプとタクソノミーを登録する。
 */
function register_ma_deal_components() {
    // =============================================================
    // 1. カスタム投稿タイプ (CPT): M&A案件 (ma_deal) の登録
    // =============================================================
    $labels = array(
        'name'          => 'M&A案件',
        'singular_name' => 'M&A案件',
        'menu_name'     => 'M&A案件',
        'add_new'       => '新規案件追加',
        'add_new_item'  => '新規M&A案件の追加',
        'edit_item'     => 'M&A案件の編集',
        'all_items'     => '案件一覧',
    );

    $args = array(
        'labels'             => $labels,
        'public'             => true, // フロントエンドで公開
        'publicly_queryable' => true, // クエリ可能
        'show_ui'            => true, // 管理画面UIを表示
        'show_in_menu'       => true, // 管理メニューに表示
        'query_var'          => true,
        'rewrite'            => array('slug' => 'deals'), // URLスラッグ
        'capability_type'    => 'post',
        'has_archive'        => true, // アーカイブページを有効化
        'hierarchical'       => false,
        'menu_position'      => 5,
        'supports'           => array('title', 'editor', 'custom-fields'), // 標準でサポートする項目
        // セキュリティ: CPTへのアクセス権限を細かく設定する場合、'capability_type'と'capabilities'を調整する
    );

    // CPTを登録
    register_post_type('ma_deal', $args);

    // エラーハンドリング: CPTの登録に失敗した場合（通常は発生しないが念のため）
    if (!post_type_exists('ma_deal')) {
        error_log('Error: Failed to register custom post type "ma_deal"');
    }


    // =============================================================
    // 2. カスタムタクソノミー: 業種 (industry) の登録
    // =============================================================
    $labels_industry = array(
        'name'          => '業種',
        'singular_name' => '業種',
        'search_items'  => '業種を検索',
        'all_items'     => '全業種',
        'parent_item'   => '親業種',
        'parent_item_colon' => '親業種:',
    );
    
    $args_industry = array(
        'hierarchical'      => true, // 階層化を有効化 (親/子カテゴリ)
        'labels'            => $labels_industry,
        'show_ui'           => true,
        'show_admin_column' => true,
        'query_var'         => true,
        'rewrite'           => array('slug' => 'industry'),
    );

    // タクソノミーを登録し、ma_dealに紐づける
    register_taxonomy('industry', 'ma_deal', $args_industry);


    // =============================================================
    // 3. カスタムタクソノミー: 所在地 (location) の登録
    // =============================================================
    $labels_location = array(
        'name'          => '所在地',
        'singular_name' => '所在地',
        'search_items'  => '所在地を検索',
        'all_items'     => '全所在地',
    );
    
    $args_location = array(
        'hierarchical'      => false, // 階層化は不要
        'labels'            => $labels_location,
        'show_ui'           => true,
        'show_admin_column' => true,
        'query_var'         => true,
        'rewrite'           => array('slug' => 'location'),
    );

    // タクソノミーを登録し、ma_dealに紐づける
    register_taxonomy('location', 'ma_deal', $args_location);
}

// パーマリンク設定のフラッシュ（CPT登録後に必要）
// 開発環境で一度実行するか、管理画面の「設定」->「パーマリンク設定」で「変更を保存」をクリック
// register_activation_hook(__FILE__, 'flush_rewrite_rules'); 
?>


2. ACF JSON: カスタムフィールドグループ設定（抜粋）

ACFプラグインの管理画面でフィールドグループを作成し、エクスポートしたJSONファイルの一部です。

JSON
{
    "key": "group_65c8f74a8a5b2",
    "title": "M&A案件情報フィールド",
    "fields": [
        {
            "key": "field_65c8f76083a21",
            "label": "案件ステータス",
            "name": "deal_status",
            "type": "select",
            "required": 1,
            "choices": {
                "募集前": "募集前",
                "募集中": "募集中",
                "交渉中": "交渉中",
                "成約済": "成約済"
            },
            "default_value": "募集中"
        },
        {
            "key": "field_65c8f78083a22",
            "label": "取引希望額 (USD)",
            "name": "target_price_usd",
            "type": "number",
            "required": 1,
            "min": 0,
            "append": "USD"
        },
        {
            "key": "field_65c8f79583a23",
            "label": "売上 (直近1年/USD)",
            "name": "revenue_last_year",
            "type": "number",
            "required": 1,
            "min": 0,
            "append": "USD"
        },
        {
            "key": "field_65c8f7aa83a24",
            "label": "EBITDA/利益 (USD)",
            "name": "ebitda",
            "type": "number",
            "required": 1,
            "min": 0,
            "append": "USD"
        },
        {
            "key": "field_65c8f7b583a25",
            "label": "機密レベル",
            "name": "confidentiality_level",
            "type": "select",
            "required": 1,
            "choices": {
                "公開": "一般公開",
                "要登録": "登録者限定",
                "要審査": "要事前審査"
            },
            "default_value": "要登録"
        }
        // ... 他のフィールド (事業概要、強みなど) を追加
    ],
    "location": [
        [
            {
                "param": "post_type",
                "operator": "==",
                "value": "ma_deal" // CPT: ma_deal に紐づける
            }
        ]
    ]
}


テストコード

このタスクの核はWordPressの構成定義であり、直接的な単体テストは難しいですが、登録後の存在確認とデータ構造の初期検証