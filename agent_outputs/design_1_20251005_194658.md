# 設計書: プロジェクトの技術選定変更（WordPress）に伴う影響範囲と実現可能性の再評価レポート作成（カスタム投稿タイプ、カスタムフィールド、プラグインの調査）

タスクID: 1
作成日時: 2025-10-05T19:46:58.949606

---

タスク概要

タスクの理解と目的

本タスクは、当初計画されていたPython（Django）/PostgreSQLベースのシステムから、WordPress環境への技術選定変更がプロジェクト目標（M&Aポータルサイトの要件定義）に与える影響を評価し、特に中核機能である企業情報管理と検索機能の実現可能性を具体的に検証することです。

目標は、カスタム投稿タイプ（CPT）、カスタムフィールド（CF）、および適切なプラグインの組み合わせにより、提案された要件をどの程度満たせるかを明確にし、以降の要件定義と設計の基礎とすることです。

設計内容

1. 企業情報管理（CPT/CF）の実現性評価

要件項目	CPT/CFの対応案	実現可能性	備考
企業（案件）基本情報	CPTとして「ma_case」を定義	高	標準機能＋カスタムフィールドプラグインで容易に実現可能。
案件ID	ACFなどのカスタムフィールド（テキスト/UUID）	高	内部的な案件IDとして利用。
M&Aスキーム	カスタムタクソノミーまたはカスタムフィールド（選択肢）	高	複数選択が必要な場合はタクソノミーが望ましい。
希望売却/買収価格	カスタムフィールド（数値）	高	価格レンジ検索の基データとして利用。機密情報としてアクセス制御が必要。
売り手企業情報	CPT「ma_case」内のカスタムフィールドグループ	高	**ACF（Advanced Custom Fields）**などのプラグインでデータ型（例: JSON/数値配列）を柔軟に定義。
直近3期売上	ACFの「リピーターフィールド」またはJSONフィールド	中	データ整合性を保つには専用のカスタムテーブル（後述）も検討が必要。
Google スプレッドシートにエクスポート

2. 検索機能の実現性評価

要件項目	WordPressでの対応案	実現可能性	備考
案件名 (部分一致)	標準のWP_Queryまたはpre_get_postsフックで対応	高	標準検索対象。パフォーマンス注意。
業種カテゴリ	カスタムタクソノミーとして定義	高	タクソノミー検索は標準機能で可能。
希望価格帯 (レンジ検索)	カスタムフィールド検索（meta_query）	中	大量データでのパフォーマンスが課題。専用プラグイン（FacetWP/SearchWPなど）またはElasticsearch/Algolia連携が推奨される。
キーワード (全文検索)	標準検索機能または専用全文検索プラグイン	中	PostgreSQLの全文検索（tsvector）のような高速性は期待できない。初期段階での性能限界を明確にすべき。
非公開情報制御	WP_Query実行時のmeta_queryによるフィルタリング	高	ログインユーザー、特定のロールを持つユーザーにのみ特定フィールドを公開するロジックをテンプレートファイルに実装。
Google スプレッドシートにエクスポート

3. 提携パートナー管理機能の実現性評価

要件項目	WordPressでの対応案	実現可能性	備考
案件登録・編集	フロントエンド投稿プラグインまたはカスタムテーマ機能	高	パートナー専用の投稿フォームを用意。
アクセス制御 (RBAC)	カスタムユーザーロール/ケイパビリティプラグインの利用	高	パートナーロールを作成し、「自身が作成した案件のみ編集・閲覧可能」とするケイパビリティを厳格に定義。
管理者承認ワークフロー	承認ワークフロープラグインまたはカスタム実装	高	投稿ステータス（Pending/Published）と通知機能で対応。
Google スプレッドシートにエクスポート

技術選定

分野	技術	選定理由
CMS基盤	WordPress (最新LTS)	要件。迅速なポータル構築、管理画面の提供、開発リソースの容易さ。
カスタムフィールド	Advanced Custom Fields (ACF Pro)	必須。複雑なデータ型（リピーター、柔軟なコンテンツ）とUIを提供し、開発効率を最大化するため。
検索機能	SearchWP / FacetWP	カスタムフィールド/タクソノミーに対する高速なファセット検索（レンジ検索など）を実現するため。meta_queryのみに依存する標準機能のパフォーマンス問題を回避。
ユーザー管理/RBAC	User Role Editor またはカスタムコード	提携パートナー、一般ユーザー、管理者の厳格なロールベースアクセス制御を実装し、セキュリティ要件（他社案件へのアクセス禁止）を満たすため。
フロントエンド投稿	Gravity Forms / Custom form plugin	パートナーが管理画面に入らず安全に案件を登録・編集できる専用フォームを実現するため。
Google スプレッドシートにエクスポート

実装における注意点

データベースの最適化と分離:

カスタムフィールドのメタデータ（wp_postmeta）が増大すると検索パフォーマンスが著しく低下する。可能な限りカスタムタクソノミー（wp_term_relationships）を活用すること。

特に機密性の高い財務データ（直近3期売上など）については、セキュリティとパフォーマンスの観点から、WordPressの標準テーブルではなく、専用のカスタムテーブルを定義し、生の$wpdbクエリまたは専用プラグインで操作することを検討する。

セキュリティ（RBACの徹底）:

提携パートナーのアクセス制御は、フロントエンド（UI）だけでなく、必ずバックエンドのWP_Queryフィルタリングとcurrent_user_canチェックで二重に検証すること。

案件の登録・編集・削除時に、現在のユーザーがその案件のpost_authorであることを厳格に確認するロジックを組み込むこと。

スケーラビリティ:

検索負荷の増大に備え、初期段階からWPEngine, Kinstaなどの高性能ホスティングと**オブジェクトキャッシュ（Redisなど）**の導入を前提とする。

カスタムフィールドに対するmeta_queryは非効率であるため、SearchWPなどのインデクシング型検索ソリューションの利用を必須とする。

次のステップ

データベーススキーマ詳細設計: CPT/CF設計に基づいて、具体的なカスタムフィールド名、データ型、およびカスタムテーブル（必要な場合）のER図/スキーマ定義書を作成する。

UI/UXワイヤーフレーム作成: 検索結果一覧画面、案件詳細画面、提携パートナー向け案件登録/編集画面のワイヤーフレームを確定する。

API仕様の定義: WordPressの標準REST APIを利用する場合、どのエンドポイントを有効化し、カスタムフィールドやカスタム投稿タイプをどのように公開/非公開にするかの仕様を定義する。